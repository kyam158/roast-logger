戻したものがこれです。

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Roast Logger</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>

<style>
body{margin:0;font-family:-apple-system;background:#fafafa}
#wrap{padding:10px}
#chartWrap{height:45vh}
button,input{width:100%;padding:12px;margin:6px 0;font-size:16px}
.row{display:flex;gap:6px}
.row>*{flex:1}
#dropBtn{background:#d32f2f;color:#fff;font-weight:bold}
#csvBtn{background:#1976d2;color:#fff}
#time{text-align:center;font-size:22px;margin:6px 0}
</style>
</head>

<body>
<div id="wrap">
  <div id="chartWrap"><canvas id="chart"></canvas></div>
  <div id="time">0:00</div>

  <button id="startBtn">焙煎開始</button>

  <label>豆温 (℃)</label>
  <div class="row">
    <input id="tempInput" type="number" value="150">
    <button id="tempSet">決定</button>
  </div>

  <label>ガス圧 (<span id="gasLabel">2.5</span>)</label>
  <input id="gasInput" type="range" min="0" max="5" step="0.5" value="2.5">

  <button id="dryBtn">Dry End（長押し）</button>
  <button id="fcBtn">1ハゼ（長押し）</button>
  <button id="dropBtn">DROP</button>

  <button id="csvBtn">CSV書き出し</button>
</div>

<script>
/* =====================
   util
===================== */
const fmt = s =>
  `${Math.floor(s/60)}:${String(s%60).padStart(2,"0")}`;

const secToMinSec = s =>
  `${Math.floor(s/60)}:${String(s%60).padStart(2,"0")}`;

/* =====================
   状態
===================== */
let startTime=null,endTime=null,timer=null;
let temp=150,gas=2.5;
let dryEnd=null,fc=null;
const tempData=[],gasData=[];

const nowSec=()=> endTime ?? Math.floor((Date.now()-startTime)/1000);

/* =====================
   Chart
===================== */
const chart=new Chart(
  document.getElementById("chart"),
  {
    type:"line",
    data:{datasets:[
      {label:"Temp",data:[],borderWidth:2},
      {label:"Gas",data:[],yAxisID:"yR",borderDash:[4,4]}
    ]},
    options:{
      animation:false,
      scales:{
        x:{type:"linear",min:0},
        y:{min:0,max:260},
        yR:{position:"right",min:0,max:5,grid:{drawOnChartArea:false}}
      }
    },

    /* ★ ここから追加 */
    plugins:[
      {
        id:"phaseMarkers",
        afterDraw(chart){
          const {ctx,scales,chartArea}=chart;

          function drawLine(t,color,label){
            if(t==null) return;
            const x=scales.x.getPixelForValue(t);
            ctx.save();
            ctx.strokeStyle=color;
            ctx.lineWidth=2;
            ctx.beginPath();
            ctx.moveTo(x,chartArea.top);
            ctx.lineTo(x,chartArea.bottom);
            ctx.stroke();

            ctx.fillStyle=color;
            ctx.font="12px sans-serif";
            ctx.fillText(label, x+4, chartArea.top+12);
            ctx.restore();
          }

          drawLine(dryEnd,"#f9a825","Dry End");
          drawLine(fc,"#e65100","1st Crack");
        }
      }
    ]
    /* ★ ここまで */
  }
);
/* =====================
   操作
===================== */
startBtn.onclick=()=>{
  startTime=Date.now();
  endTime=null;
  dryEnd=fc=null;
  tempData.length=0;
  gasData.length=0;
  tempData.push({x:0,y:temp});
  gasData.push({x:0,y:gas});
  clearInterval(timer);
  timer=setInterval(draw,1000);
  draw();
};

tempSet.onclick=()=>{
  temp=parseInt(tempInput.value)||temp;
  tempData.push({x:nowSec(),y:temp});
  draw();
};

gasInput.oninput=()=>{
  gas=parseFloat(gasInput.value);
  gasLabel.textContent=gas.toFixed(1);
  gasData.push({x:nowSec(),y:gas});
  draw();
};

/* =====================
   長押し
===================== */
let hold=null;
const holdStart=f=>hold=setTimeout(f,600);
const holdCancel=()=>clearTimeout(hold);

dryBtn.onpointerdown=e=>{e.preventDefault();holdStart(()=>dryEnd=nowSec());};
fcBtn.onpointerdown=e=>{e.preventDefault();holdStart(()=>fc=nowSec());};
[dryBtn,fcBtn].forEach(b=>{
  b.onpointerup=holdCancel;
  b.onpointercancel=holdCancel;
});

/* =====================
   DROP
===================== */
dropBtn.onclick=()=>{
  if(!startTime||endTime) return;
  endTime=nowSec();
  clearInterval(timer);
  draw();
};

/* =====================
   CSV書き出し
===================== */
csvBtn.onclick=()=>{
  if(!tempData.length) return alert("データなし");

  let csv=[
    "# Roast Logger CSV",
    `# DryEnd,${dryEnd ?? ""}`,
    `# FirstCrack,${fc ?? ""}`,
    `# Drop,${endTime ?? ""}`,
    "time(mm:ss),temperature(C),gas"
  ];

  const map={};
  tempData.forEach(d=>{
    map[d.x]=map[d.x]||{};
    map[d.x].t=d.y;
  });
  gasData.forEach(d=>{
    map[d.x]=map[d.x]||{};
    map[d.x].g=d.y;
  });

  Object.keys(map).sort((a,b)=>a-b).forEach(t=>{
    csv.push(
      `${secToMinSec(Number(t))},${map[t].t??""},${map[t].g??""}`
    );
  });

  const blob=new Blob([csv.join("\n")],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=`roast_${Date.now()}.csv`;
  a.click();
};
</script>
</body>
</html>
